{% extends "base.html" %}
{% block content %}

<div class="container-narrow mx-auto" style="max-width:860px;">
  <h2 class="text-center mt-3 mb-2">Hi {{ c.name.split(' ')[0] if c.name else '' }}!</h2>
  <p class="text-center mb-4">To help us get to know you better, please answer a few short questions.</p>

  <form method="post" id="cam-form" novalidate>
    <!-- Prep tips card -->
    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <h6 class="mb-3">Preparation Tips</h6>
        <div class="border-top py-3">
          <strong class="me-2">üîó Stable Internet Connection</strong>
          <div class="text-muted small">Ensure a reliable connection to avoid interruptions.</div>
        </div>
        <div class="border-top py-3">
          <strong class="me-2">üîá Quiet Environment</strong>
          <div class="text-muted small">Choose a quiet place to minimize background noise.</div>
        </div>
      </div>
    </div>

    <!-- Camera card -->
    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <h6 class="mb-2">Allow Camera Access</h6>
        <div class="text-muted small mb-3">
          To ensure fairness and authenticity, we‚Äôll ask your browser for camera access when you continue.
          Your video and activity data will only be used for identity verification and integrity purposes.
        </div>

        <!-- Static illustration (no interactivity) -->
        <div class="permission-illustration d-flex justify-content-center my-2">
          <!-- Inline SVG so you don‚Äôt need to manage an extra image file -->
          <svg width="360" height="220" viewBox="0 0 360 220" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Browser permission dialog illustration">
            <defs>
              <filter id="cardShadow" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow dx="0" dy="2" stdDeviation="6" flood-opacity=".18"/>
              </filter>
              <rect id="btn" rx="10" ry="10" width="220" height="30"/>
            </defs>
            <!-- card -->
            <rect x="70" y="25" width="220" height="170" rx="12" fill="#fff" stroke="#e6e9ef" filter="url(#cardShadow)"/>
            <!-- header -->
            <text x="90" y="60" fill="#111827" font-size="12" font-family="Inter, Arial, sans-serif" font-weight="600">abcdefg.com wants to</text>
            <text x="90" y="78" fill="#6b7280" font-size="11" font-family="Inter, Arial, sans-serif">Use your camera</text>
            <!-- buttons -->
            <g transform="translate(80,95)">
              <use href="#btn" fill="#ebf2ff" x="0" y="0"/>
              <text x="110" y="20" text-anchor="middle" font-family="Inter, Arial, sans-serif" font-size="12" fill="#1e40af" font-weight="600">Allow this time</text>

              <use href="#btn" fill="#eef2f7" x="0" y="40"/>
              <text x="110" y="60" text-anchor="middle" font-family="Inter, Arial, sans-serif" font-size="12" fill="#334155">Allow on every visit</text>

              <use href="#btn" fill="#f4f5f7" x="0" y="80"/>
              <text x="110" y="100" text-anchor="middle" font-family="Inter, Arial, sans-serif" font-size="12" fill="#111827">Don‚Äôt allow</text>
            </g>
            <!-- pointer hand -->
            <g transform="translate(268,118) rotate(12)">
              <circle cx="0" cy="0" r="12" fill="#fff" stroke="#e5e7eb"/>
              <path d="M-3,-2 h6 a2,2 0 0 1 2,2 v12 a2,2 0 0 1 -2,2 h-6 a2,2 0 0 1 -2,-2 v-12 a2,2 0 0 1 2,-2z" fill="#111827"/>
              <path d="M-7,8 h14" stroke="#111827" stroke-width="3" stroke-linecap="round"/>
            </g>
          </svg>
        </div>

        <!-- Warning (they can still continue even if they later deny in the browser) -->
        <div class="alert alert-warning d-flex align-items-start gap-2 small mt-3" role="alert" style="border-radius:12px;">
          ‚ö†Ô∏è <div><strong>Heads up:</strong> If you deny camera access in your browser, your application may be voided by the hiring team.
          You can still proceed below.</div>
        </div>
      </div>
    </div>

    <!-- Required acknowledgement -->
    <div class="card mb-4 shadow-sm">
      <div class="card-body">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="ack" name="ack" required>
          <label class="form-check-label" for="ack">
            I understand that not responding to questions may forfeit my opportunity.
          </label>
        </div>
      </div>
    </div>

    <div class="text-center">
      <button id="startBtn" class="btn btn-primary px-4" type="submit">Start</button>
    </div>
  </form>
</div>

<style>
  .container-narrow { padding-bottom: 32px; }
  .permission-illustration svg { max-width: 100%; height: auto; }
</style>

<script>
  (function(){
    const form = document.getElementById('cam-form');
    const btn  = document.getElementById('startBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();               // always capture submit
      if (!form.reportValidity()) return; // enforce required checkbox
      btn.disabled = true;

      // Try to trigger the real browser camera prompt.
      try {
        if (navigator.mediaDevices?.getUserMedia) {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          // Immediately stop tracks; we only needed the prompt.
          stream.getTracks().forEach(t => t.stop());
        }
      } catch (err) {
        // User denied or device unavailable ‚Äî intentionally ignore.
      } finally {
        form.submit(); // proceed either way
      }
    });
  })();
</script>

{% endblock %}
