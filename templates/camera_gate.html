{% extends "base.html" %}
{% block content %}

<div class="mx-auto" style="max-width:980px;">
  <h2 class="text-center mb-2" style="font-weight:600;">Hi {{ (c.name or 'there').split(' ')[0] }}!</h2>
  <p class="text-center text-muted mb-4">
    To help us get to know you better, please answer a few short questions.<br>
    Follow the guidelines below to ensure the best possible session.
  </p>

  <!-- Prep tips -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="fw-semibold mb-2">Preparation Tips</div>
      <p class="text-muted mb-3">Follow these recommendations for the best interview experience.</p>

      <hr class="my-2">
      <div class="d-flex align-items-start gap-2 py-2">
        <span class="text-primary mt-1">○</span>
        <div>
          <div class="fw-semibold">Stable Internet Connection</div>
          <div class="text-muted small">Ensure you have a reliable internet connection to avoid interruptions during the interview.</div>
        </div>
      </div>

      <hr class="my-2">
      <div class="d-flex align-items-start gap-2 py-2">
        <span class="text-primary mt-1">○</span>
        <div>
          <div class="fw-semibold">Quiet Environment</div>
          <div class="text-muted small">Choose a quiet, well-lit space with minimal background noise.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Camera access -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="fw-semibold mb-2">Allow Camera Access</div>
      <p class="text-muted mb-3">
        To ensure fairness and authenticity for all candidates, please allow access to your camera before starting.
      </p>

      <hr class="my-2">

      <div class="d-flex align-items-start gap-2">
        <span class="text-primary mt-1">○</span>
        <div class="flex-grow-1">
          <div class="fw-semibold">Camera Access</div>
          <div class="text-muted small mb-3">
            Your video and activity data will only be used for identity verification and evaluation integrity purposes.
            They will not be stored or shared externally.
          </div>

          <!-- Browser prompt mock (purely visual) -->
          <div class="cg-prompt shadow-sm border rounded-3 p-3 mx-auto" style="max-width:340px;">
            <div class="small fw-semibold mb-2 text-muted">abcdefg.com wants to</div>
            <div class="small mb-3">Use your camera</div>
            <div class="d-grid gap-2">
              <button type="button" class="btn btn-light border">Allow this time</button>
              <button type="button" class="btn btn-light border">Allow on every visit</button>
              <button type="button" class="btn btn-light border">Don’t allow</button>
            </div>
          </div>

          <div class="text-muted small mt-3">
            <strong>Note:</strong> You can proceed even if you choose “Don’t allow,” but doing so may void your application.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Acknowledgement + Start -->
  <form id="cam-form" method="post" novalidate>
    <div class="card mb-3">
      <div class="card-body">
        <div class="fw-semibold mb-2">Acknowledgement</div>
        <p class="text-muted small mb-3">
          Failure to answer questions may result in removal from consideration for this role.
        </p>

        <div class="form-check mb-1">
          <input class="form-check-input" type="checkbox" id="ack" name="ack" required>
          <label class="form-check-label" for="ack">
            I understand that not responding to questions may forfeit my opportunity, and that declining camera access may void my application.
          </label>
        </div>
      </div>
    </div>

    <div class="text-center">
      <button id="startBtn" class="btn btn-primary px-5" type="submit">Start</button>
    </div>
  </form>
</div>

<!-- Page-scoped styles so we don't affect anything else -->
<style>
  .cg-prompt .btn { border-radius: 10px; }
</style>

<script>
  (function () {
    const form = document.getElementById('cam-form');
    const btn  = document.getElementById('startBtn');
    const ack  = document.getElementById('ack');

    btn.addEventListener('click', async function (e) {
      // Let HTML5 required validation run first
      if (!form.checkValidity()) {
        // allow browser to show native validation UI
        return;
      }
      e.preventDefault();

      // Try to trigger the browser's camera prompt; continue regardless of outcome.
      try {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          // Immediately stop tracks; we only needed the permission prompt.
          stream.getTracks().forEach(t => t.stop());
        }
      } catch (err) {
        // Permission denied or no device — intentionally ignored.
      }
      form.submit();
    });
  })();
</script>

{% endblock %}
