{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">Candidates — {{ code }}</h3>

<div class="card p-0">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th style="width: 110px;">ID</th>
          <th style="width: 220px;">Name</th>
          <th style="width: 260px;">Email</th>
          <th style="width: 100px;">Fit</th>
          <th style="width: 130px;">Claim Avg</th>
          <th style="width: 180px;">Created</th>
          <th class="text-end" style="width: 160px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for c in apps %}
          {% set r = c.resume_json or {} %}
          {% set email = r.get('applicant_email') %}
          {% set avgv = (c.answer_scores|sum / (c.answer_scores|length))|round(2)
                        if c.answer_scores and (c.answer_scores|length) > 0 else None %}
          {% set fit_class = 'badge-green' if c.fit_score and c.fit_score >= 4
                             else ('badge-yellow' if c.fit_score and c.fit_score >= 3 else 'badge-red') %}
          {% set avg_class = 'badge-green' if avgv and avgv >= 4
                             else ('badge-yellow' if avgv and avgv >= 3 else 'badge-red') %}
          <tr>
            <td class="font-monospace">{{ c.id }}</td>
            <td>{{ c.name }}</td>
            <td>{{ email or '—' }}</td>
            <td>
              {% if c.fit_score is not none %}
                <span class="badge badge-score {{ fit_class }}">{{ c.fit_score }}</span>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>
              {% if avgv is not none %}
                <span class="badge badge-score {{ avg_class }}">{{ avgv }}</span>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>
              {% if c.created_at %}
                {{ c.created_at.strftime('%Y-%m-%d %H:%M') }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('detail', cid=c.id) }}">View</a>
              <a class="btn btn-sm btn-outline-danger"
                 href="{{ url_for('delete_candidate', cid=c.id) }}"
                 onclick="return confirm('Delete this application?');">Delete</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
