{% extends "base.html" %}
{% block content %}

<a href="{{ url_for('recruiter', tenant=tenant_slug) }}">← Back</a>
<h3 class="mt-2">{{ title }}</h3>

<div class="mb-3 small">
  Public Apply Link:
  <a class="text-decoration-none"
     href="{{ url_for('apply', tenant=tenant_slug, code=code, _external=True) }}"
     target="_blank">
    {{ url_for('apply', tenant=tenant_slug, code=code, _external=True) }}
  </a>
</div>

<table class="table align-middle">
  <thead>
    <tr>
      <th><a href="?sort=name&dir={{ 'asc' if request.args.get('dir')=='desc' else 'desc' }}">Name</a></th>
      <th><a href="?sort=fit&dir={{ 'asc' if request.args.get('dir')=='desc' else 'desc' }}">Fit</a></th>
      <th><a href="?sort=claim&dir={{ 'asc' if request.args.get('dir')=='desc' else 'desc' }}">Claim Validity</a></th>
      <th><a href="?sort=created&dir={{ 'asc' if request.args.get('dir')=='desc' else 'desc' }}">Applied</a></th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for a in apps %}
      {% set avgv = (a.answer_scores|sum / (a.answer_scores|length))|round(2)
                    if a.answer_scores and (a.answer_scores|length) > 0 else None %}
      <tr>
        <td>
          <a class="text-decoration-none"
             href="{{ url_for('detail', tenant=tenant_slug, cid=a.id) }}">
             {{ a.name }}
          </a>
        </td>
        <td>{{ a.fit_score }}</td>
        <td>
          {% if avgv is not none %}
            {{ avgv }}
          {% else %}
            —
          {% endif %}
        </td>
        <td>{{ a.created_at.strftime('%Y-%m-%d %H:%M') if a.created_at else '—' }}</td>
        <td class="text-nowrap">
          <a class="btn btn-sm btn-outline-secondary me-1"
             href="{{ url_for('detail', tenant=tenant_slug, cid=a.id) }}">View</a>
          <a class="btn btn-sm btn-outline-danger"
             href="{{ url_for('delete_candidate', tenant=tenant_slug, cid=a.id) }}"
             onclick="return confirm('Delete {{ a.name }} ({{ a.id }})? This cannot be undone.');">
            Delete
          </a>
        </td>
      </tr>
    {% else %}
      <tr><td colspan="5" class="text-muted">No candidates yet.</td></tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
