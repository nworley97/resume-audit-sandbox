{% extends "billing/base_billing.html" %}
{% block title %}Checkout - ALTERA{% endblock %}

{% block head_extra %}
<style>
  .checkout-container {
    max-width: 480px;
    width: 100%;
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
    overflow: hidden;
  }
  
  .checkout-header {
    background: #1e293b;
    color: white;
    padding: 2rem 1.5rem;
    text-align: center;
    border-radius: 1rem 1rem 0 0;
  }
  
  .checkout-header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }
  
  .checkout-header .plan-summary {
    display: flex;
    justify-content: center;
    align-items: baseline;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .checkout-header .plan-name {
    font-size: 1.125rem;
    font-weight: 500;
  }
  
  .checkout-header .plan-price {
    font-size: 1.75rem;
    font-weight: 700;
  }
  
  .checkout-header .plan-cycle {
    font-size: 1rem;
    opacity: 0.85;
  }
  
  .checkout-body {
    padding: 1.5rem;
  }
  
  .form-group {
    margin-bottom: 1rem;
  }
  
  .form-group label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.375rem;
  }
  
  .form-group input {
    width: 100%;
    padding: 0.625rem 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }
  
  .form-group input:focus {
    outline: none;
    border-color: #1e293b;
    box-shadow: 0 0 0 3px rgba(30, 41, 59, 0.1);
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
  
  .form-row-3 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 0.75rem;
  }
  
  .card-icons {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  
  .card-icons img {
    height: 24px;
    opacity: 0.6;
  }
  
  .section-title {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #64748b;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e2e8f0;
  }
  
  .order-summary {
    background: #f8fafc;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 1.5rem;
  }
  
  .order-summary .line-item {
    display: flex;
    justify-content: space-between;
    font-size: 0.875rem;
    padding: 0.25rem 0;
  }
  
  .order-summary .line-item.total {
    font-weight: 600;
    border-top: 1px solid #e2e8f0;
    margin-top: 0.5rem;
    padding-top: 0.75rem;
  }
  
  .secure-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 1rem;
  }
  
  .secure-badge svg {
    width: 1rem;
    height: 1rem;
    color: #10b981;
  }
  
  .error-message {
    background: #fef2f2;
    border: 1px solid #fecaca;
    color: #dc2626;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    margin-bottom: 1rem;
  }
  
  .back-link {
    display: block;
    text-align: center;
    margin-top: 1rem;
    font-size: 0.875rem;
    color: #64748b;
  }
  
  .back-link:hover {
    color: #1e293b;
  }
</style>
{% endblock %}

{% block content %}
<div class="checkout-container">
  <div class="checkout-header">
    <h1>Complete Your Purchase</h1>
    <div class="plan-summary">
      <span class="plan-name">{{ plan_display }} Plan</span>
      <span class="plan-price">
        {% if amount == 0 %}
          Free
        {% elif billing_cycle == 'yearly' %}
          ${{ "%.2f"|format(amount) }}
        {% else %}
          ${{ amount|int }}
        {% endif %}
      </span>
      {% if amount > 0 %}
      <span class="plan-cycle">/{{ 'year' if billing_cycle == 'yearly' else 'month' }}</span>
      {% endif %}
    </div>
  </div>
  
  <div class="checkout-body">
    
    {% with messages = get_flashed_messages(category_filter=['error']) %}
    {% if messages %}
    <div class="error-message">
      {% for message in messages %}
      <p>{{ message }}</p>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
    
    <form method="POST" action="{{ url_for('billing.checkout') }}" id="checkout-form">
      <!-- Account Summary -->
      <div class="order-summary">
        <div class="line-item">
          <span>Account</span>
          <span>{{ signup_data.email }}</span>
        </div>
        <div class="line-item">
          <span>Company</span>
          <span>{{ signup_data.company_name }}</span>
        </div>
        <div class="line-item">
          <span>Plan</span>
          <span>{{ plan_display }} ({{ billing_cycle }})</span>
        </div>
        <div class="line-item total">
          <span>Total {% if billing_cycle == 'yearly' %}per year{% else %}per month{% endif %}</span>
          <span>
            {% if amount == 0 %}
              $0.00
            {% else %}
              ${{ "%.2f"|format(amount) }}
            {% endif %}
          </span>
        </div>
      </div>
      
      <!-- Payment Section -->
      <div class="section-title">Payment Information</div>
      
      <div class="card-icons">
        <!-- Card brand icons -->
        <svg width="38" height="24" viewBox="0 0 38 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="38" height="24" rx="4" fill="#1A1F71"/>
          <path d="M15.5 16.5L17 7.5H19.5L18 16.5H15.5Z" fill="white"/>
          <path d="M25.5 7.7C25 7.5 24.2 7.3 23.2 7.3C20.7 7.3 19 8.6 19 10.4C19 11.7 20.1 12.4 21 12.9C21.9 13.4 22.2 13.7 22.2 14.1C22.2 14.7 21.5 15 20.8 15C19.8 15 19.3 14.9 18.5 14.5L18.2 14.4L17.9 16.2C18.5 16.5 19.5 16.7 20.6 16.7C23.2 16.7 24.9 15.4 24.9 13.5C24.9 12.5 24.3 11.7 23 11C22.2 10.5 21.7 10.2 21.7 9.7C21.7 9.3 22.1 8.9 23 8.9C23.8 8.9 24.4 9.1 24.8 9.3L25 9.4L25.5 7.7Z" fill="white"/>
          <path d="M28.5 7.5H26.5C25.9 7.5 25.5 7.7 25.3 8.2L21.5 16.5H24.1L24.6 15H27.7L28 16.5H30.5L28.5 7.5ZM25.3 13.1C25.5 12.5 26.4 10.2 26.4 10.2C26.4 10.2 26.6 9.6 26.7 9.3L26.9 10.1C26.9 10.1 27.4 12.5 27.5 13.1H25.3Z" fill="white"/>
          <path d="M13.5 7.5L11 13.5L10.7 12C10.3 10.7 9.1 9.3 7.8 8.6L10 16.5H12.6L16.1 7.5H13.5Z" fill="white"/>
          <path d="M9.5 7.5H5.5L5.5 7.7C8.5 8.5 10.5 10.5 11.2 12.8L10.4 8.3C10.3 7.8 9.9 7.5 9.5 7.5Z" fill="#F9A533"/>
        </svg>
        <svg width="38" height="24" viewBox="0 0 38 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="38" height="24" rx="4" fill="#252525"/>
          <circle cx="15" cy="12" r="7" fill="#EB001B"/>
          <circle cx="23" cy="12" r="7" fill="#F79E1B"/>
          <path d="M19 6.8C20.5 8 21.5 9.9 21.5 12C21.5 14.1 20.5 16 19 17.2C17.5 16 16.5 14.1 16.5 12C16.5 9.9 17.5 8 19 6.8Z" fill="#FF5F00"/>
        </svg>
        <svg width="38" height="24" viewBox="0 0 38 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="38" height="24" rx="4" fill="#016FD0"/>
          <path d="M10 16V8L6 12L10 16Z" fill="white"/>
          <path d="M12 8H28V16H12V8Z" fill="white"/>
          <text x="20" y="13.5" font-size="5" font-weight="bold" fill="#016FD0" text-anchor="middle">AMEX</text>
        </svg>
      </div>
      
      <div class="form-group">
        <label for="card_number">Card Number</label>
        <input type="text" id="card_number" name="card_number" required 
               placeholder="1234 5678 9012 3456"
               pattern="[\d\s]{13,19}"
               maxlength="19"
               autocomplete="cc-number">
      </div>
      
      <div class="form-row-3">
        <div class="form-group">
          <label for="exp_month">Month</label>
          <select id="exp_month" name="exp_month" required 
                  class="w-full px-3 py-2.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
            <option value="">MM</option>
            {% for m in range(1, 13) %}
            <option value="{{ m }}">{{ "%02d"|format(m) }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label for="exp_year">Year</label>
          <select id="exp_year" name="exp_year" required
                  class="w-full px-3 py-2.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
            <option value="">YYYY</option>
            {% for y in range(2025, 2037) %}
            <option value="{{ y }}">{{ y }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label for="cvc">CVC</label>
          <input type="text" id="cvc" name="cvc" required 
                 placeholder="123"
                 pattern="\d{3,4}"
                 maxlength="4"
                 autocomplete="cc-csc">
        </div>
      </div>
      
      <button type="submit" class="btn-primary" id="submit-btn">
        {% if amount == 0 %}
          Start Free
        {% else %}
          Pay ${{ "%.2f"|format(amount) }}
        {% endif %}
      </button>
      
      <div class="secure-badge">
        <svg viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
        </svg>
        <span>Secure payment powered by Stripe</span>
      </div>
    </form>
    
    <a href="{{ url_for('billing.signup') }}" class="back-link">‚Üê Back to plan selection</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(function() {
  // Format card number with spaces
  const cardInput = document.getElementById('card_number');
  cardInput.addEventListener('input', function(e) {
    let value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
    let formatted = '';
    for (let i = 0; i < value.length; i++) {
      if (i > 0 && i % 4 === 0) {
        formatted += ' ';
      }
      formatted += value[i];
    }
    e.target.value = formatted;
  });
  
  // CVC input - numbers only
  const cvcInput = document.getElementById('cvc');
  cvcInput.addEventListener('input', function(e) {
    e.target.value = e.target.value.replace(/\D/g, '');
  });
  
  // Form submission
  const form = document.getElementById('checkout-form');
  const submitBtn = document.getElementById('submit-btn');
  
  form.addEventListener('submit', function(e) {
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Processing...';
  });
})();
</script>
{% endblock %}

