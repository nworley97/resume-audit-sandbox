{% extends "billing/base_billing.html" %}
{% block title %}Payment Successful - ALTERA{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 py-12">
  <div class="bg-white rounded-lg shadow-lg p-8 text-center">
    <div class="mb-6">
      <svg class="w-16 h-16 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
    </div>
    
    <h1 class="text-2xl font-bold text-slate-900 mb-4">Payment Successful!</h1>
    
    <p class="text-slate-600 mb-6">
      Thank you for your payment. Your account is being set up now.
    </p>
    
    {% if signup_data %}
    <div class="bg-slate-50 rounded-lg p-4 mb-6 text-left">
      <p class="text-sm text-slate-600 mb-2"><strong>Email:</strong> {{ signup_data.email }}</p>
      <p class="text-sm text-slate-600 mb-2"><strong>Plan:</strong> {{ signup_data.plan_tier|title }} ({{ signup_data.billing_cycle }})</p>
      <p class="text-sm text-slate-600"><strong>Company:</strong> {{ signup_data.company_name }}</p>
    </div>
    {% endif %}
    
    <div id="status-message" class="text-sm text-slate-500 mb-6">
      <div id="loading-indicator" class="flex items-center justify-center gap-2">
        <div class="w-4 h-4 border-2 border-primary/30 border-t-primary rounded-full animate-spin"></div>
        <span>Setting up your account...</span>
      </div>
    </div>
    
    <a href="{{ url_for('billing.payment_success') }}" class="btn-primary inline-block" id="continue-btn">
      Check Account Status
    </a>
    
    <p class="text-xs text-slate-400 mt-4">
      If your account isn't ready after a minute, please <a href="{{ url_for('login') }}" class="text-primary underline">try logging in</a>.
    </p>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh the page every 3 seconds to check if account was created
(function() {
  let attempts = 0;
  const maxAttempts = 20; // Stop after ~60 seconds
  
  function checkStatus() {
    attempts++;
    if (attempts >= maxAttempts) {
      document.getElementById('loading-indicator').innerHTML = 
        '<span>Account setup is taking longer than expected. Please try logging in.</span>';
      return;
    }
    // Reload the page - server will redirect if account is ready
    setTimeout(function() {
      window.location.reload();
    }, 3000);
  }
  
  checkStatus();
})();
</script>
{% endblock %}

