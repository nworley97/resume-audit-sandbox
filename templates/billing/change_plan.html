{% extends "base_app.html" %}
{% block title %}Change Plan - ALTERA{% endblock %}

{% block head_extra %}
<style>
  .plan-option {
    border: 2px solid #e2e8f0;
    border-radius: 0.75rem;
    padding: 1.25rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .plan-option:hover {
    border-color: #cbd5e1;
  }
  
  .plan-option.selected {
    border-color: #1e293b;
    background: rgba(30, 41, 59, 0.02);
  }
  
  .plan-option input[type="radio"] {
    display: none;
  }
  
  .plan-check {
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid #cbd5e1;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  
  .plan-option.selected .plan-check {
    border-color: #1e293b;
    background: #1e293b;
  }
  
  .plan-option.selected .plan-check svg {
    display: block;
  }
  
  .plan-check svg {
    display: none;
    width: 0.75rem;
    height: 0.75rem;
    color: white;
  }
  
  .current-badge {
    background: #f0fdf4;
    color: #166534;
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
  <a href="{{ url_for('billing.account') }}" class="text-slate-500 hover:text-slate-700 text-sm mb-4 inline-flex items-center gap-1">
    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
    </svg>
    Back to Billing
  </a>
  
  <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6">
    <h1 class="text-xl font-semibold text-title mb-2">Change Your Plan</h1>
    <p class="text-slate-500 text-sm mb-6">
      Select a new plan. Changes take effect immediately.
    </p>
    
    {# Flash messages are now rendered by base_app.html #}
    
    <form method="POST" action="{{ url_for('billing.change_plan') }}" id="change-plan-form">
      <!-- Billing Cycle Toggle -->
      <div class="flex items-center justify-center gap-4 mb-6">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="radio" name="billing_cycle" value="monthly" 
                 {% if subscription.billing_cycle == 'monthly' %}checked{% endif %}
                 class="w-4 h-4 text-primary focus:ring-primary">
          <span class="text-sm font-medium">Monthly</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="radio" name="billing_cycle" value="yearly"
                 {% if subscription.billing_cycle == 'yearly' %}checked{% endif %}
                 class="w-4 h-4 text-primary focus:ring-primary">
          <span class="text-sm font-medium">Yearly</span>
          <span class="text-xs text-green-600 font-medium">Save 35%</span>
        </label>
      </div>
      
      <!-- Plan Options -->
      <div class="space-y-3 mb-6">
        {% for plan in plans %}
        <label class="plan-option block {% if plan.tier == current_tier %}selected{% endif %}" data-tier="{{ plan.tier }}">
          <input type="radio" name="plan_tier" value="{{ plan.tier }}" 
                 {% if plan.tier == current_tier %}checked{% endif %}>
          <div class="flex items-start justify-between">
            <div class="flex items-start gap-3">
              <div class="plan-check mt-0.5">
                <svg viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div>
                <div class="flex items-center gap-2">
                  <span class="font-semibold text-title">{{ plan.display_name }}</span>
                  {% if plan.tier == current_tier %}
                  <span class="current-badge">Current</span>
                  {% endif %}
                </div>
                <div class="text-sm text-slate-500 mt-1">
                  {{ plan.limits.active_jobs }} active jobs • 
                  {{ plan.limits.monthly_resumes }} resumes/mo • 
                  {{ plan.limits.seats_included }} seat{% if plan.limits.seats_included > 1 %}s{% endif %}
                </div>
              </div>
            </div>
            <div class="text-right">
              <div class="font-semibold text-title">
                <span class="monthly-price">
                  {% if plan.monthly_price == 0 %}Free{% else %}${{ plan.monthly_price }}{% endif %}
                </span>
                <span class="yearly-price hidden">
                  {% if plan.yearly_price == 0 %}Free{% else %}${{ "%.2f"|format(plan.yearly_price) }}{% endif %}
                </span>
              </div>
              <div class="text-xs text-slate-400">
                <span class="monthly-label">per month</span>
                <span class="yearly-label hidden">per year</span>
              </div>
            </div>
          </div>
        </label>
        {% endfor %}
      </div>
      
      <!-- Enterprise Option -->
      <div class="text-center mb-6">
        <a href="{{ url_for('billing.enterprise') }}" class="text-sm text-primary hover:underline">
          Need more? Contact us for Enterprise pricing →
        </a>
      </div>
      
      <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors">
        Update Plan
      </button>
    </form>
  </div>
</div>

<script>
(function() {
  // Handle plan selection
  document.querySelectorAll('.plan-option').forEach(option => {
    option.addEventListener('click', function() {
      document.querySelectorAll('.plan-option').forEach(o => o.classList.remove('selected'));
      this.classList.add('selected');
      this.querySelector('input[type="radio"]').checked = true;
    });
  });
  
  // Handle billing cycle toggle
  const cycleInputs = document.querySelectorAll('input[name="billing_cycle"]');
  cycleInputs.forEach(input => {
    input.addEventListener('change', function() {
      const isYearly = this.value === 'yearly';
      document.querySelectorAll('.monthly-price').forEach(el => el.classList.toggle('hidden', isYearly));
      document.querySelectorAll('.yearly-price').forEach(el => el.classList.toggle('hidden', !isYearly));
      document.querySelectorAll('.monthly-label').forEach(el => el.classList.toggle('hidden', isYearly));
      document.querySelectorAll('.yearly-label').forEach(el => el.classList.toggle('hidden', !isYearly));
    });
  });
  
  // Initialize based on current selection
  const currentCycle = document.querySelector('input[name="billing_cycle"]:checked');
  if (currentCycle && currentCycle.value === 'yearly') {
    document.querySelectorAll('.monthly-price').forEach(el => el.classList.add('hidden'));
    document.querySelectorAll('.yearly-price').forEach(el => el.classList.remove('hidden'));
    document.querySelectorAll('.monthly-label').forEach(el => el.classList.add('hidden'));
    document.querySelectorAll('.yearly-label').forEach(el => el.classList.remove('hidden'));
  }
})();
</script>
{% endblock %}

