{% extends "base.html" %}
{% block content %}

<a href="{{ url_for('view_candidates', tenant=tenant_slug, code=c.jd_code) }}">← Back</a>
<h3 class="mt-2">{{ c.name }}</h3>

<p class="mb-2">
  ID: {{ c.id }}<br>
  JD:
  {% if c.jd_code %}
    <a href="{{ url_for('view_candidates', tenant=tenant_slug, code=c.jd_code) }}" class="text-decoration-none">
      {{ c.jd_code }}
    </a>
  {% else %}—{% endif %}
  — {{ jd.title if jd else '' }}<br>

  {% if c.jd_code %}
    Public Apply Link:
    <a class="text-decoration-none"
       href="{{ url_for('apply', tenant=tenant_slug, code=c.jd_code, _external=True) }}"
       target="_blank">
      {{ url_for('apply', tenant=tenant_slug, code=c.jd_code, _external=True) }}
    </a><br>
  {% endif %}
</p>

<p class="mb-4">
  {% set s = c.fit_score or 0 %}
  Fit:
  <span class="badge {% if s>=4 %}bg-success{% elif s==3 %}bg-warning text-dark{% else %}bg-danger{% endif %}">
    {{ s }}/5
  </span>
  &nbsp;&nbsp;Avg Q:
  <strong>
    {% if c.answer_scores %}
      {{ (c.answer_scores|sum / c.answer_scores|length)|round(2) }}
    {% else %}-{% endif %}
  </strong>
</p>

<h5>Q&A</h5>
<table class="table">
  <thead><tr><th style="width:45%">Q</th><th style="width:45%">A</th><th class="text-center" style="width:10%">Score</th></tr></thead>
  <tbody>
    {% for q, a, s in qa %}
      <tr>
        <td><strong>{{ q }}</strong></td>
        <td>{{ a or '-' }}</td>
        <td class="text-center">
          <span class="badge {% if s>=4 %}bg-success{% elif s==3 %}bg-warning text-dark{% else %}bg-danger{% endif %}">
            {{ s }}
          </span>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<a class="btn btn-outline-secondary" href="{{ url_for('download_resume', tenant=tenant_slug, cid=c.id) }}">Download résumé</a>
{% endblock %}
