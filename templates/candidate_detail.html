{% extends "base.html" %}
{% block content %}

<h3 class="mb-3">Candidate Detail</h3>

<div class="card mb-3">
  <div class="card-header">Candidate</div>
  <div class="card-body">
    <p><strong>Name:</strong> {{ c.name }}</p>
    <p><strong>ID:</strong> {{ c.id }}</p>
    <p><strong>Job:</strong> {{ jd.title if jd else c.jd_code }}</p>
    <p>
      <a class="btn btn-sm btn-outline-primary" href="{{ url_for('download_resume', tenant=tenant_slug, cid=c.id) }}">Download Résumé</a>
      <a class="btn btn-sm btn-outline-danger" href="{{ url_for('delete_candidate', tenant=tenant_slug, cid=c.id) }}">Delete Candidate</a>
    </p>
  </div>
</div>

<div class="card mb-3">
  <div class="card-header">Scores</div>
  <div class="card-body">
    <p>Fit: {{ c.fit_score or "N/A" }}</p>
    {% if c.answer_scores %}
      <p>Average Answer Score: {{ (c.answer_scores | sum / (c.answer_scores|length)) | round(2) }}</p>
    {% endif %}
    {% if c.left_tab_count is not none %}
      <p>Focus Changes Detected: {{ c.left_tab_count }}</p>
    {% endif %}
  </div>
</div>

<div class="card mb-3">
  <div class="card-header">Questions & Answers</div>
  <div class="card-body">
    <ol>
      {% for q, a, s in qa %}
        <li class="mb-3">
          <strong>{{ q }}</strong><br>
          <em>Answer:</em> {{ a or "(no answer)" }}<br>
          <em>Score:</em> {{ s }}
        </li>
      {% endfor %}
    </ol>
  </div>
</div>

{% if c.resume_json and c.resume_json._self_id %}
<div class="card mb-3">
  <div class="card-header">Voluntary Self-Identification</div>
  <div class="card-body">
    <dl class="row">
      <dt class="col-sm-4">Gender</dt>
      <dd class="col-sm-8">{{ c.resume_json._self_id.gender }}</dd>

      <dt class="col-sm-4">Hispanic/Latino</dt>
      <dd class="col-sm-8">{{ c.resume_json._self_id.hispanic }}</dd>

      <dt class="col-sm-4">Veteran Status</dt>
      <dd class="col-sm-8">{{ c.resume_json._self_id.veteran }}</dd>

      <dt class="col-sm-4">Disability</dt>
      <dd class="col-sm-8">{{ c.resume_json._self_id.disability }}</dd>
    </dl>
  </div>
</div>
{% endif %}

<a class="btn btn-secondary" href="{{ url_for('view_candidates', tenant=tenant_slug, code=c.jd_code) }}">Back to Candidates</a>

{% endblock %}
