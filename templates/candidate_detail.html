{% extends "base.html" %}
{% block content %}

<a href="{{ url_for('view_candidates', tenant=tenant_slug, code=c.jd_code) }}">← Back</a>
<h3 class="mt-2">{{ c.name }}</h3>

<p class="mb-2">
  ID: {{ c.id }}<br>
  JD:
  {% if c.jd_code %}
    <a href="{{ url_for('view_candidates', tenant=tenant_slug, code=c.jd_code) }}" class="text-decoration-none">
      {{ c.jd_code }}
    </a>
  {% else %}—{% endif %}
  {% if jd and jd.title %} — {{ jd.title }}{% endif %}<br>
  <span class="text-muted">Tab switches detected: {{ c.left_tab_count or 0 }}</span>
</p>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">Scores</div>
      <div class="card-body">
        <div>Fit: <strong>{{ c.fit_score }}</strong></div>
        <div>Realism: <strong>{{ 'Likely genuine' if c.realism else 'Potentially AI-assisted' }}</strong></div>
      </div>
    </div>

    {% if c.resume_json and c.resume_json.get('_self_id') %}
    <div class="card mt-3">
      <div class="card-header">Voluntary Self-Identification</div>
      <div class="card-body">
        <pre class="mb-0">{{ c.resume_json['_self_id'] | tojson(indent=2) }}</pre>
      </div>
    </div>
    {% endif %}
  </div>

  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">Q&A</div>
      <div class="card-body">
        <table class="table table-sm align-middle">
          <thead>
            <tr><th style="width:40%">Question</th><th>Answer</th><th style="width:12%">Score</th></tr>
          </thead>
          <tbody>
            {% for q, a, s in qa %}
              <tr>
                <td class="small">{{ q }}</td>
                <td class="small">{{ a }}</td>
                <td class="small text-center">{{ s }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="mt-3">
  <a class="btn btn-outline-secondary me-2"
     href="{{ url_for('download_resume', tenant=tenant_slug, cid=c.id) }}">Download résumé</a>
  <a class="btn btn-outline-danger"
     href="{{ url_for('delete_candidate', tenant=tenant_slug, cid=c.id) }}"
     onclick="return confirm('Delete {{ c.name }} ({{ c.id }})? This cannot be undone.');">
    Delete
  </a>
</div>

{% endblock %}
